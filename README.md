# 无敌支付接口规范



## 文档说明



### 前言

本标准规定了聚合支付平台互联网支付产品的技术规范，以便商户接入聚合支付互联网支付系统，本文档规范包括交易种类、交易正常处理流程、异常情况的处理流程、消息域、消息各式以及交易报文的格式说明。



### 阅读对象

《无敌支付接口规范》文档是面向具有一定的网站开发能力，了解相关计算机语言的网站开发、维护和管理人员



### 业务术语

注意:  应用ID与商户号是不同的概念 ,支付参数中只需要传递payKey ,无需传递商户号

| 术语                    | 解释                                                         |
| ----------------------- | ------------------------------------------------------------ |
| 商户                    | 商户是指企业或个人在支付系统注册成为商户身份，可以通过平台进行支付交易。商户必须是拥有营业执照的企事业单位。 |
| 应用ID                 | 应用ID是商户在支付平台的唯一标识，是用来判断 商户在平台合法性的唯一条件 |
| 支付密钥(key) | 商户支付密钥是商户在进行交易请求时，对数据做加密验签使用的密钥。是平台验证商户交易请求合法性的唯一判断条件，商户应当妥善保管支付密钥，如有泄露，应及时联系平台进行替换。 |
| 后台异步通知            | 系统在接收到交易数据处理完成后，支付系统主动发起通知给商户的网站，同时携带处理完成的结果信息反馈给商户网站。 |
| 页面同步通知            | 用户支付成功后，页面跳转地址。最终支付结果应该以后台异步通知为准。该地址只作为页面跳转用。 |
| 产品类型                | 产品类型是平台用来区分支付产品类别的字段，具体描述见接口描述 |
| 商户订单号              | 商户订单号是有商户系统每生成一笔订单会产生的一个唯一标识该笔订单的号码，商户应该保证订单号的唯一性。 |
| 扩展字段                | 扩展字段是用来预留给商户做备用字段的，平台不会对扩展字段做任何处理，支付完成会将扩展字段原样返回。 |



### 请求/响应模式

本系统采用HTTP 1.0作为客户端系统与服务器系统之间的通信协议，客户端使用post方式(且请求头Content-Type:application/x-www-form-urlencoded)上送数据到服务器端，服务器端返回传输数据格式采用JSON



### 响应数据结构

```json
{
"resultCode":"0000",
"payMessage":"weixin://wxpay/bizpayurl?pr=sD123F1",
"errMsg":"",
"sign":"BC6EBE4BB6D6E574EC6C2EE42A0705A0"
}
```



### 数据安全

 平台默认使用MD5签名方式进行数据验签，保证数据完整性。请求方在请求数据是将请求数据按照键值对的方式通过'&'符号进行拼接后 + “&key”，获取到签名源文。将源文进行MD5签名后转大写，作为sign字段放在请求报文中。源文拼接方式为：按照参数名称进行ASCII编码排序，如果参数值为空，则不参与签名

#### 拼接示例：

```java
amount=100&applicationID=3d51f975fb8c4987972a6f9e9bb65f0b&channel=weixin_h5_t0&notifyUrl=https://www.baidu.com&orderId=1584187552821&orderTime=20190313161912&payIp=127.0.0.1&remark=remark&returnUrl=https://www.baidu.com&shopName=productName&key=5f150e5a02e94aefac9aa37c2da731b1
```



## 接口参数规范

### 单笔订单支付请求

#### 请求地址

http://interface.gyoya.com/pay/h5_scan

#### 请求参数

| 名称          | 说明                                 | 类型   | 可否为空 | 最大长度 |
| ------------- | ------------------------------------ | ------ | -------- | -------- |
| applicationID | 应用ID(非商户号)                     | String | 否       | 32       |
| amount        | 订单金额，单位：元  保留小数点后两位 | String | 否       | 12       |
| orderId       | 商户支付订单号                       | String | 否       | 30       |
| channel       | 产品类型参考下方产品类型编码         | String | 否       | 8        |
| orderTime     | 下单时间，格式yyyyMMddHHmmss         | String | 否       | 14       |
| shopName      | 商品名称                             | String | 否       | 200      |
| payIp         | 下单IP                               | String | 否       | 15       |
| returnUrl     | 页面通知地址                         | String | 否       | 300      |
| notifyUrl     | 后台异步通知地址                     | String | 否       | 300      |
| remark        | 备注                                 | String | 是       | 200      |
| sign          | 签名                                 | String | 否       | 50       |

#### 响应参数

| 名称       | 说明                               | 类型   | 可否为空 | 最大长度 |
| ---------- | ---------------------------------- | ------ | -------- | -------- |
| resultCode | sign                               | String | 否       | 4        |
| payMessage | 支付请求信息，响应码为‘0000’时非空 | String | 否       | 500      |
| errMsg     | 错误描述响应码不为‘0000’时非空     | String | 否       | 300      |
| sign       | 签名                               | String | 否       | 50       |



### 异步支付结果回调通知

商户平台需要实现该接口，并在接受处理完成后返回 “SUCCESS”。如商户不返回处理结果，平台会再继续通知四次（即：一共五次）。商户应该对接收处理逻辑做幂等性处理防止多次通知多次处理。

#### 响应参数

| 名称          | 说明                                                         | 类型   | 可否为空 | 最大长度 |
| ------------- | ------------------------------------------------------------ | ------ | -------- | -------- |
| applicationID | 应用ID                                                  | String | 否       | 32       |
| shopName      | 支付产品名称                                                 | String | 否       | 200      |
| orderId       | 商户订单号                                                   | String | 否       | 20       |
| amount        | 订单金额，单位：元  保留小数点后两位                         | String | 否       | 12       |
| channel       | 产品类型参考下方产品类型编码                                 | String | 否       | 8        |
| status        | 订单状态 SUCCESS 交易成功   FAILED 交易失败  WAITING_PAYMENT 等待支付 | String | 否       | 20       |
| successTime   | 成功时间，格式  yyyyMMddHHmmss                               | String | 否       | 15       |
| orderTime     | 下单时间，格式   yyyyMMddHHmmss                              | String | 否       | 15       |
| trxNo         | 交易流水号                                                   | String | 否       | 50       |
| remark        | 备注                                                         | String | 是       | 200      |
| sign          | 签名                                                         | String | 否       | 50       |



### 支付结果查询接口

#### 请求地址

http://interface.gyoya.com/query/singleOrder

#### 请求参数

| 名称          | 说明       | 类型   | 可否为空 | 最大长度 |
| ------------- | ---------- | ------ | -------- | -------- |
| applicationID | 应用ID     | String | 否       | 32       |
| outTradeNo    | 商户订单号 | String | 否       | 30       |
| sign          | 签名       | String | 否       | 50       |



#### 响应参数
| 名称       | 说明        | 类型   | 可否为空 | 最大长度 |
| ---------- | ----------- | ------ | -------- | -------- |
| resultCode     | 响应码 | String | 否       | 4     |
| outTradeNo | 商户订单号，响应码为‘0000’时非空  | String | 否       | 30       |
| orderStatus       | 订单状态，响应码为‘0000’时非空  SUCCESS 支付成功   FAILED 支付失败WAITING_PAYMENT 等待支付| String | 否       | 30      |
| orderPrice     | 订单金额，单位：元 保留小数点后两位 | String | 否       | 12   |
| trxNo     | 交易流水号 | String | 否       | 50   |
| completeDate     | 支付完成时间，格式 yyyyMMddHHmmss | String | 否       | 14    |
| errMsg     | 错误描述  响应码不为‘0000’时非空 | String | 否       | 300   |
| sign     | 签名 | String | 否       | 50    |



### 支付通道编码

| 通道名称   | 通道编码       |
| ---------- | -------------- |
| 微信扫码   | weixin_scan_t0 |
| 微信H5     | weixin_h5_t0   |
| 支付宝扫码 | alipay_scan_t0 |
| 支付宝H5   | alipay_h5_t0   |


